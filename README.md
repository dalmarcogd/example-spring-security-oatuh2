# example-spring-security-oauth2

<div class="inside-article"> <div class="entry-content" itemprop="text"> <!-- WP QUADS Content Ad Plugin v. 1.4.0 --><div class="quads-location quads-ad1" id="quads-ad1" style="float:left;margin:10px 10px 10px 0;"> <!-- Ads 300x250 javabycode.com --> <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-6464458213264070" data-ad-slot="2257654921"></ins> </div><p>This tutorial shows you how to Secure Spring Rest API Using <a title="Spring Security" href="http://javabycode.com/spring-framework-tutorial/spring-security" data-wpel-link="internal">Spring Security</a> Oauth2 Example. OAuth2 is an authentication framework that allows third-party applications to grant limited access to a HTTP service, either on behalf of a resource owner or by allowing the third-party application to obtain access on its own behalf.</p><p>Table of contents:<br> 1. OAuth2 Introduction<br> 2. Configure Resource Server<br> 3. Configure Authorization Server<br> 4. Spring Security Configuration<br> 5. Spring Rest Controller<br> 6. Deploy Secure Spring Rest API Using Spring Security Oauth2 Example</p><h3 class="crp-list-title">Other interesting posts you may like</h3><ul class="crp-list"><li><a href="http://javabycode.com/spring-framework-tutorial/spring-mvc-tutorial/cross-origin-request-blocked-spring-mvc-restful-angularjs.html" data-wpel-link="internal">Cross Origin Request Blocked Spring MVC Restful Angularjs</a></li><li><a href="http://javabycode.com/spring-framework-tutorial/spring-security/spring-security-4-authentication-annotation-xml-example.html" data-wpel-link="internal">Spring Security 4 Authentication Annotation XML Example</a></li><li><a href="http://javabycode.com/spring-framework-tutorial/spring-security/spring-security-basic-authentication-example.html" data-wpel-link="internal">Spring Security Basic Authentication Example</a></li><li><a href="http://javabycode.com/spring-framework-tutorial/spring-mvc-tutorial/spring-4-mvc-tutorial-spring-4-mvc-example.html" data-wpel-link="internal">Spring 4 MVC Tutorial vs Full Spring 4 MVC Example Project</a></li></ul><p><strong>OAuth2 Introduction</strong><br> OAuth2 defines four roles:<br> <em>Resource Owner</em>: One user or yourself or an entity capable of granting access to a protected resource.<br> <em>Resource Server</em>: One server that stores protected resources, this server supports access token for request and response.<br> <em>Authorization Server</em>: One server that distributes access tokens to client after successfully authentication the resource owner and obtaining authorization.<br> <em>Client</em>: An application making requests to protected resources on behalf of the owner. It can be a web app server, a mobile app, a client side application. In this example, we are using DHC REST Client like a client.</p><p>We donâ€™t introduce OAuth2 deeply here. You can refer to the completely <a target="_blank" href="http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/" data-wpel-link="external" rel="external noopener noreferrer">OAuth2 tutorial</a>. We will focus on how to create Spring Rest API Using Spring Security Oauth2 Example step by step.</p><p><strong>Configure Resource Server</strong><br> Resource Server stores the protected resources that client needs. We configure resource server by creating the custom class of ResourceServerConfigurer. Here is the code snippet.</p><p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta --><div id="crayon-59a886fdbec71824504038" class="crayon-syntax crayon-theme-eclipse crayon-font-verdana crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;"><div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span><div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button crayon-pressed" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div><div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important; margin-top: -21px; display: none;"></div><div class="crayon-plain-wrap">

</div><div class="crayon-main" style="position: relative; z-index: 0; overflow: hidden; opacity: 0;"><table class="crayon-table" style=""><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"><div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-2">2</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-4">4</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-6">6</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-8">8</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-10">10</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-12">12</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-14">14</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-16">16</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-18">18</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-20">20</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-22">22</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-24">24</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-26">26</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-28">28</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec71824504038-30">30</div><div class="crayon-num" data-line="crayon-59a886fdbec71824504038-31">31</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-59a886fdbec71824504038-1"><span class="crayon-t">package</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">javabycode</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-2">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec71824504038-3"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">context</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Configuration</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-4"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">builders</span><span class="crayon-sy">.</span><span class="crayon-v">HttpSecurity</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-5"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configuration</span><span class="crayon-sy">.</span><span class="crayon-v">EnableResourceServer</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-6"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configuration</span><span class="crayon-sy">.</span><span class="crayon-v">ResourceServerConfigurerAdapter</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-7"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configurers</span><span class="crayon-sy">.</span><span class="crayon-v">ResourceServerSecurityConfigurer</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-8"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">error</span><span class="crayon-sy">.</span><span class="crayon-v">OAuth2AccessDeniedHandler</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-10"><span class="crayon-sy">@</span><span class="crayon-e">Configuration</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-11"><span class="crayon-sy">@</span><span class="crayon-e">EnableResourceServer</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-12"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">OAuth2ResourceServerConfig</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">ResourceServerConfigurerAdapter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-14"><span class="crayon-h"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-m">final</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">RESOURCE_ID</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"SPRING_REST_API"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-15"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-16"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-17"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-e">ResourceServerSecurityConfigurer </span><span class="crayon-v">resources</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-18"><span class="crayon-h"> </span><span class="crayon-v">resources</span><span class="crayon-sy">.</span><span class="crayon-e">resourceId</span><span class="crayon-sy">(</span><span class="crayon-v">RESOURCE_ID</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">stateless</span><span class="crayon-sy">(</span><span class="crayon-t">false</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-19"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-20">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec71824504038-21"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-22"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-e">HttpSecurity </span><span class="crayon-v">http</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-23"><span class="crayon-h"> </span><span class="crayon-v">http</span><span class="crayon-sy">.</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-24"><span class="crayon-h"> </span><span class="crayon-e">anonymous</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">disable</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-25"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">requestMatchers</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">antMatchers</span><span class="crayon-sy">(</span><span class="crayon-s">"/fruits/**"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-26"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-st">and</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">authorizeRequests</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-27"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">antMatchers</span><span class="crayon-sy">(</span><span class="crayon-s">"/fruits/**"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">access</span><span class="crayon-sy">(</span><span class="crayon-s">"hasRole('ADMIN')"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-28"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-st">and</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">exceptionHandling</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">accessDeniedHandler</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">OAuth2AccessDeniedHandler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec71824504038-29"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec71824504038-30">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec71824504038-31"><span class="crayon-sy">}</span></div></div></td></tr></tbody></table></div></div> <!-- [Format Time: 0.0044 seconds] --><p></p><p>Letâ€™s dig deeper:<br> Following the above code, Resources are located on path /fruits/. @EnableResourceServer annotation eanbles a Spring Security filter that authenticates requests. These incoming requests have to include OAuth2 token.</p><p><strong>Configure Authorization Server</strong></p><p>Authorization server is responsible for verifying user credentials. And Authorization server will provide tokens (access-token or refresh-token) if the user credentials are valid. It also stores some other information such as registered client, access scopes and grant types. We configure the Authorization Server with the below code:</p><p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta --><div id="crayon-59a886fdbec7a119751913" class="crayon-syntax crayon-theme-eclipse crayon-font-verdana crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;"><div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span><div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div><div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div><div class="crayon-plain-wrap">


</div><div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;"><table class="crayon-table" style=""><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"><div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-2">2</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-4">4</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-6">6</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-8">8</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-10">10</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-12">12</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-14">14</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-16">16</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-18">18</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-20">20</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-22">22</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-24">24</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-26">26</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-28">28</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-30">30</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-32">32</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-34">34</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-36">36</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-38">38</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-40">40</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-42">42</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-44">44</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-46">46</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-48">48</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-50">50</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-52">52</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec7a119751913-54">54</div><div class="crayon-num" data-line="crayon-59a886fdbec7a119751913-55">55</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-59a886fdbec7a119751913-1"><span class="crayon-t">package</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">javabycode</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-2">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-3"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">beans</span><span class="crayon-sy">.</span><span class="crayon-v">factory</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Autowired</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-4"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">beans</span><span class="crayon-sy">.</span><span class="crayon-v">factory</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Qualifier</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-5"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">context</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Configuration</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-6"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">authentication</span><span class="crayon-sy">.</span><span class="crayon-v">AuthenticationManager</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-7"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">configurers</span><span class="crayon-sy">.</span><span class="crayon-v">ClientDetailsServiceConfigurer</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-8"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configuration</span><span class="crayon-sy">.</span><span class="crayon-v">AuthorizationServerConfigurerAdapter</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-9"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configuration</span><span class="crayon-sy">.</span><span class="crayon-v">EnableAuthorizationServer</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-10"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configurers</span><span class="crayon-sy">.</span><span class="crayon-v">AuthorizationServerEndpointsConfigurer</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-11"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configurers</span><span class="crayon-sy">.</span><span class="crayon-v">AuthorizationServerSecurityConfigurer</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-12"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">approval</span><span class="crayon-sy">.</span><span class="crayon-v">UserApprovalHandler</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-13"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">.</span><span class="crayon-v">TokenStore</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-14">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-15"><span class="crayon-sy">@</span><span class="crayon-e">Configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-16"><span class="crayon-sy">@</span><span class="crayon-e">EnableAuthorizationServer</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-17"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">AuthServerOAuth2Config</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">AuthorizationServerConfigurerAdapter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-18">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-19"><span class="crayon-h"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-m">static</span><span class="crayon-h"> </span><span class="crayon-t">String</span><span class="crayon-h"> </span><span class="crayon-v">REALM</span><span class="crayon-o">=</span><span class="crayon-s">"EXAMPLE_REALM"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-20"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-21"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-22"><span class="crayon-e"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">TokenStore </span><span class="crayon-v">tokenStore</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-24"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-25"><span class="crayon-e"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">UserApprovalHandler </span><span class="crayon-v">handler</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-26">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-27"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">Autowired</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-28"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Qualifier</span><span class="crayon-sy">(</span><span class="crayon-s">"authenticationManagerBean"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-29"><span class="crayon-h"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">AuthenticationManager </span><span class="crayon-v">authManager</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-30">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-31"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-32"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-e">ClientDetailsServiceConfigurer </span><span class="crayon-v">clients</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-34"><span class="crayon-h"> </span><span class="crayon-v">clients</span><span class="crayon-sy">.</span><span class="crayon-e">inMemory</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-35"><span class="crayon-h"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">withClient</span><span class="crayon-sy">(</span><span class="crayon-s">"trusted-client"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">authorizedGrantTypes</span><span class="crayon-sy">(</span><span class="crayon-s">"password"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"authorization_code"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"refresh_token"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"implicit"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">authorities</span><span class="crayon-sy">(</span><span class="crayon-s">"ROLE_CLIENT"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"ROLE_TRUSTED_CLIENT"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">scopes</span><span class="crayon-sy">(</span><span class="crayon-s">"read"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"write"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"trust"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">secret</span><span class="crayon-sy">(</span><span class="crayon-s">"secret"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">accessTokenValiditySeconds</span><span class="crayon-sy">(</span><span class="crayon-cn">300</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-c">//invalid after 5 minutes.</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">refreshTokenValiditySeconds</span><span class="crayon-sy">(</span><span class="crayon-cn">600</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-c">//refresh after 10 minutes.</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-42"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-44"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-45"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-e">AuthorizationServerEndpointsConfigurer </span><span class="crayon-v">endpoints</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-46"><span class="crayon-h"> </span><span class="crayon-v">endpoints</span><span class="crayon-sy">.</span><span class="crayon-e">tokenStore</span><span class="crayon-sy">(</span><span class="crayon-v">tokenStore</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">userApprovalHandler</span><span class="crayon-sy">(</span><span class="crayon-v">handler</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-47"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">authenticationManager</span><span class="crayon-sy">(</span><span class="crayon-v">authManager</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-48"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-50"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-51"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-e">AuthorizationServerSecurityConfigurer </span><span class="crayon-v">oauthServer</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-52"><span class="crayon-h"> </span><span class="crayon-v">oauthServer</span><span class="crayon-sy">.</span><span class="crayon-e">realm</span><span class="crayon-sy">(</span><span class="crayon-v">REALM</span><span class="crayon-o">+</span><span class="crayon-s">"/client"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-53"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec7a119751913-54">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec7a119751913-55"><span class="crayon-sy">}</span></div></div></td></tr></tbody></table></div></div> <!-- [Format Time: 0.0066 seconds] --><p></p><p>Letâ€™s dig deeper:</p><p>@EnableAuthorizationServer annotation is used to enable an Authorization Server in the current application context. The configure(ClientDetailsServiceConfigurer clients) method configures the ClientDetailsService, e.g. declaring individual clients and their properties. The method configures the non-security features of the Authorization Server endpoints, like token store, token customizations, user approvals and grant types. The method configures the security of the Authorization Server, which means in practical terms the /oauth/token endpoint.</p><p><strong>Spring Security Configuration</strong><br> We configure spring secruity for the application by creating the WebSecurityConfigurerAdapter class that extends from the WebSecurityConfigurerAdapter class.</p><p></p><!-- Crayon Syntax Highlighter v_2.7.2_beta --><div id="crayon-59a886fdbec80232081232" class="crayon-syntax crayon-theme-eclipse crayon-font-verdana crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important; height: auto;"><div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important; height: 18px !important; line-height: 18px !important; margin-top: -19px; display: none; position: absolute; z-index: 2;"><span class="crayon-title"></span><div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button crayon-pressed" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code" style="display: none;"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" ><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" <div class="crayon-button-icon"></div></div></div></div><div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div><div class="crayon-plain-wrap">


</div><div class="crayon-main" style="position: relative; z-index: 1; overflow: hidden;"><table class="crayon-table" style=""><tbody><tr class="crayon-row"><td class="crayon-nums " data-settings="show"><div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-2">2</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-4">4</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-6">6</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-8">8</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-10">10</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-12">12</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-14">14</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-16">16</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-18">18</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-20">20</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-22">22</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-24">24</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-26">26</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-28">28</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-30">30</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-32">32</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-34">34</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-36">36</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-38">38</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-40">40</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-42">42</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-44">44</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-46">46</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-48">48</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-50">50</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-52">52</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-54">54</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-56">56</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-58">58</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-60">60</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-62">62</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-64">64</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-66">66</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-68">68</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-70">70</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-59a886fdbec80232081232-72">72</div><div class="crayon-num" data-line="crayon-59a886fdbec80232081232-73">73</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-59a886fdbec80232081232-1"><span class="crayon-t">package</span><span class="crayon-h"> </span><span class="crayon-v">com</span><span class="crayon-sy">.</span><span class="crayon-v">javabycode</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-2">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec80232081232-3"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">beans</span><span class="crayon-sy">.</span><span class="crayon-v">factory</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Autowired</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-4"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">context</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Bean</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-5"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">context</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">Configuration</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-6"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">authentication</span><span class="crayon-sy">.</span><span class="crayon-v">AuthenticationManager</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-7"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">authentication</span><span class="crayon-sy">.</span><span class="crayon-v">builders</span><span class="crayon-sy">.</span><span class="crayon-v">AuthenticationManagerBuilder</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-8"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">builders</span><span class="crayon-sy">.</span><span class="crayon-v">HttpSecurity</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-9"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configuration</span><span class="crayon-sy">.</span><span class="crayon-v">EnableWebSecurity</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-10"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">config</span><span class="crayon-sy">.</span><span class="crayon-v">annotation</span><span class="crayon-sy">.</span><span class="crayon-v">web</span><span class="crayon-sy">.</span><span class="crayon-v">configuration</span><span class="crayon-sy">.</span><span class="crayon-v">WebSecurityConfigurerAdapter</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-11"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">ClientDetailsService</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-12"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">approval</span><span class="crayon-sy">.</span><span class="crayon-v">ApprovalStore</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-13"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">approval</span><span class="crayon-sy">.</span><span class="crayon-v">TokenApprovalStore</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-14"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">approval</span><span class="crayon-sy">.</span><span class="crayon-v">TokenStoreUserApprovalHandler</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-15"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">request</span><span class="crayon-sy">.</span><span class="crayon-v">DefaultOAuth2RequestFactory</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-16"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">.</span><span class="crayon-v">TokenStore</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-17"><span class="crayon-e">import </span><span class="crayon-v">org</span><span class="crayon-sy">.</span><span class="crayon-v">springframework</span><span class="crayon-sy">.</span><span class="crayon-v">security</span><span class="crayon-sy">.</span><span class="crayon-v">oauth2</span><span class="crayon-sy">.</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">token</span><span class="crayon-sy">.</span><span class="crayon-v">store</span><span class="crayon-sy">.</span><span class="crayon-v">InMemoryTokenStore</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-18">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec80232081232-19"><span class="crayon-sy">@</span><span class="crayon-e">Configuration</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-20"><span class="crayon-sy">@</span><span class="crayon-e">EnableWebSecurity</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-21"><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-e">OAuth2SecurityConfig</span><span class="crayon-h"> </span><span class="crayon-r">extends</span><span class="crayon-h"> </span><span class="crayon-e">WebSecurityConfigurerAdapter</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-22">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec80232081232-23"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-24"><span class="crayon-e"> </span><span class="crayon-m">private</span><span class="crayon-h"> </span><span class="crayon-e">ClientDetailsService </span><span class="crayon-v">clientService</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-25"><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-26"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-27"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">globalUserDetails</span><span class="crayon-sy">(</span><span class="crayon-e">AuthenticationManagerBuilder </span><span class="crayon-v">auth</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">auth</span><span class="crayon-sy">.</span><span class="crayon-e">inMemoryAuthentication</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">withUser</span><span class="crayon-sy">(</span><span class="crayon-s">"javabycode"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">password</span><span class="crayon-sy">(</span><span class="crayon-s">"123456"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">roles</span><span class="crayon-sy">(</span><span class="crayon-s">"USER"</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-st">and</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">.</span><span class="crayon-e">withUser</span><span class="crayon-sy">(</span><span class="crayon-s">"admin"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">password</span><span class="crayon-sy">(</span><span class="crayon-s">"admin123"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">roles</span><span class="crayon-sy">(</span><span class="crayon-s">"ADMIN"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-e">Override</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-35"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">protected</span><span class="crayon-h"> </span><span class="crayon-t">void</span><span class="crayon-h"> </span><span class="crayon-e">configure</span><span class="crayon-sy">(</span><span class="crayon-e">HttpSecurity </span><span class="crayon-v">http</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-36"><span class="crayon-h"> </span><span class="crayon-i">http</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-37"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">csrf</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">disable</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-38"><span class="crayon-h"> </span><span class="crayon-sy">.</span><span class="crayon-e">anonymous</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">disable</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-39"><span class="crayon-h"> &nbsp;&nbsp; </span><span class="crayon-sy">.</span><span class="crayon-e">authorizeRequests</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-40"><span class="crayon-h"> &nbsp;&nbsp; </span><span class="crayon-sy">.</span><span class="crayon-e">antMatchers</span><span class="crayon-sy">(</span><span class="crayon-s">"/oauth/token"</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">permitAll</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-42">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec80232081232-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-i">Override</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">@</span><span class="crayon-e">Bean</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-45"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">AuthenticationManager </span><span class="crayon-e">authenticationManagerBean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">super</span><span class="crayon-sy">.</span><span class="crayon-e">authenticationManagerBean</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-48">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec80232081232-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-50"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Bean</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-51"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">TokenStore </span><span class="crayon-e">tokenStore</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-52"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">InMemoryTokenStore</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-53"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-54">&nbsp;</div><div class="crayon-line" id="crayon-59a886fdbec80232081232-55"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">Bean</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-56"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-57"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">TokenStoreUserApprovalHandler </span><span class="crayon-e">userApprovalHandler</span><span class="crayon-sy">(</span><span class="crayon-e">TokenStore </span><span class="crayon-v">tokenStore</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-58"><span class="crayon-h"> </span><span class="crayon-e">TokenStoreUserApprovalHandler </span><span class="crayon-v">handler</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TokenStoreUserApprovalHandler</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-59"><span class="crayon-h"> </span><span class="crayon-v">handler</span><span class="crayon-sy">.</span><span class="crayon-e">setTokenStore</span><span class="crayon-sy">(</span><span class="crayon-v">tokenStore</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-60"><span class="crayon-h"> </span><span class="crayon-v">handler</span><span class="crayon-sy">.</span><span class="crayon-e">setRequestFactory</span><span class="crayon-sy">(</span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">DefaultOAuth2RequestFactory</span><span class="crayon-sy">(</span><span class="crayon-v">clientService</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-61"><span class="crayon-h"> </span><span class="crayon-v">handler</span><span class="crayon-sy">.</span><span class="crayon-e">setClientDetailsService</span><span class="crayon-sy">(</span><span class="crayon-v">clientService</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-62"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">handler</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-63"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-64"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-65"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-i">Bean</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-66"><span class="crayon-h"> </span><span class="crayon-sy">@</span><span class="crayon-e">Autowired</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-67"><span class="crayon-e"> </span><span class="crayon-m">public</span><span class="crayon-h"> </span><span class="crayon-e">ApprovalStore </span><span class="crayon-e">approvalStore</span><span class="crayon-sy">(</span><span class="crayon-e">TokenStore </span><span class="crayon-v">tokenStore</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">throws</span><span class="crayon-h"> </span><span class="crayon-e">Exception</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-68"><span class="crayon-h"> </span><span class="crayon-e">TokenApprovalStore </span><span class="crayon-v">store</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">TokenApprovalStore</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-69"><span class="crayon-h"> </span><span class="crayon-v">store</span><span class="crayon-sy">.</span><span class="crayon-e">setTokenStore</span><span class="crayon-sy">(</span><span class="crayon-v">tokenStore</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-70"><span class="crayon-h"> </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">store</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-71"><span class="crayon-h"> </span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-59a886fdbec80232081232-72"><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-59a886fdbec80232081232-73"><span class="crayon-sy">}</span></div></div></td></tr></tbody></table></div></div> <!-- [Format Time: 0.0089 seconds] --><p></p><p>The globalUserDetails(AuthenticationManagerBuilder auth) method configures resource owner ( javabycode and admin user). The configure(HttpSecurity http) method configures security for the endpoint /oauth/token. We get tokens (access token and refresh token) via the endpoint /oauth/token.</p><p><strong>Spring Rest Controller</strong><br> We reuse the rest controller named FruitController from the previous post <a href="http://javabycode.com/spring-framework-tutorial/spring-security/spring-security-basic-authentication-example.html" target="_blank" data-wpel-link="internal">Spring Security Basic Authentication Example</a>. You can refer it on that post or look into in source code attachment. And we donâ€™t mention it here.</p><p><strong>Deploy Secure Spring Rest API Using Spring Security Oauth2 Example</strong><br> After building the project by maven we deploy the file war on application server (Tomcat 8 for example). We are using DHC REST client to test rest api with oauth2.</p><p>Access the URL localhost:8080/spring-oauth2-example/fruits without any authorization. The message is 401 Unauthorized like below image:</p><p><img src="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401.png" alt="Secure Spring Rest API Using Spring Security Oauth2 Example 401" width="943" height="505" class="aligncenter size-full wp-image-551" srcset="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401.png 943w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401-300x161.png 300w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401-768x411.png 768w" sizes="(max-width: 943px) 100vw, 943px"></p><p>Get tokens using HTTP POST on endpoint /oauth/token with grant_type=password and resource owner like the URL localhost:8080/spring-oauth2-example/oauth/token?grant_type=password&amp;username=admin&amp;password=admin123. One more, you have to set Header Authorization with client credential myRestClient/P@ssw0rd. You will receive both access token and refresh token. Here is the result screen:</p><p><img src="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-token.png" alt="Secure Spring Rest API Using Spring Security Oauth2 Example token" width="933" height="536" class="aligncenter size-full wp-image-554" srcset="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-token.png 933w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-token-300x172.png 300w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-token-768x441.png 768w" sizes="(max-width: 933px) 100vw, 933px"></p><p>Use the access token to request resources. Notices that the access token is valid for 2 minutes. Here is URL we you need localhost:8080/spring-oauth2-example/fruits?access_token=454b4db8-644e-4e72-bd8f-0b13f5c859fe and the screen displays like this:</p><p><img src="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-success.png" alt="Secure Spring Rest API Using Spring Security Oauth2 Example success" width="937" height="536" class="aligncenter size-full wp-image-555" srcset="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-success.png 937w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-success-300x172.png 300w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-success-768x439.png 768w" sizes="(max-width: 937px) 100vw, 937px"></p><p>This access token is invalid after 2 minutes. We run this localhost:8080/spring-oauth2-example/fruits?access_token=454b4db8-644e-4e72-bd8f-0b13f5c859fe again to see this case</p><p><img src="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401-1.png" alt="Secure Spring Rest API Using Spring Security Oauth2 Example 401" width="939" height="513" class="aligncenter size-full wp-image-556" srcset="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401-1.png 939w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401-1-300x164.png 300w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-401-1-768x420.png 768w" sizes="(max-width: 939px) 100vw, 939px"></p><p>We get  new access token by submitting a post with refresh-token. The URL looks like this: http:/localhost:8080/spring-oauth2-example/oauth/token?grant_type=refresh_token&amp;refresh_token=5168074a-fb24-46c2-bb43-786ebd01d00f</p><p><img src="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-refresh.png" alt="Secure Spring Rest API Using Spring Security Oauth2 Example refresh" width="943" height="601" class="aligncenter size-full wp-image-557" srcset="http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-refresh.png 943w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-refresh-300x191.png 300w, http://javabycode.com/wp-content/uploads/2016/08/Spring-Rest-API-Using-Spring-Security-Oauth2-Example-refresh-768x489.png 768w" sizes="(max-width: 943px) 100vw, 943px"></p><p>Thatâ€™s all on the tutorial Secure Spring Rest API Using Spring Security Oauth2 Example.<br> </p>
